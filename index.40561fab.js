var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},r={},n=e.parcelRequiref497;null==n&&((n=function(e){if(e in t)return t[e].exports;if(e in r){var n=r[e];delete r[e];var o={id:e,exports:{}};return t[e]=o,n.call(o.exports,o,o.exports),o.exports}var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(e,t){r[e]=t},e.parcelRequiref497=n),n.register("2mTEf",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.VirtualMachine=e.exports.toStringCodeLocation=e.exports.EmptyCodeLocation=void 0;var r=n("bLFXl"),o=n("6PleH"),s=n("2n3io"),i=n("iIv5n"),a=n("hxs7z"),u=n("aoVf1"),c=n("bDrYL"),l=n("4dh1X"),p=n("4OWy8"),h=n("2fEeR");e.exports.EmptyCodeLocation={startLineNumber:0,startColumnNumber:0,endLineNumber:0,endColumnNumber:0},e.exports.toStringCodeLocation=function(e){return`${e.startLineNumber}:${e.startColumnNumber} -> ${e.endLineNumber}:${e.endColumnNumber}}`};e.exports.VirtualMachine=class{constructor(e){this.builtinScope=void 0,this._lineCounter=0,this.running=!1,this.paused=!1,this.currentCode=h.VMFunction.Empty,this._stack=[],this._stackTrace=[],this._stackSize=e,this._globalScope=new o.Scope,this._currentScope=this._globalScope}get globalScope(){return this._globalScope}get lineCounter(){return this._lineCounter}get stack(){return this._stack}get stackTrace(){return this._stackTrace}reset(){this._globalScope=new o.Scope,this._currentScope=this._globalScope,this._lineCounter=0,this._stack=[],this._stackTrace=[],this.running=!1,this.paused=!1}changeToScript(e){this._lineCounter=0,this._stack=[],this._stackTrace=[],this.builtinScope=e.builtinScope,this.currentCode=e.code}execute(e){for(this.changeToScript(e),this.running=!0,this.paused=!1;this.running&&!this.paused;)this.step()}step(){if(this._lineCounter>=this.currentCode.code.length)return void(this.tryCallReturn()||(this.running=!1));const e=this.currentCode.code[this._lineCounter++];switch(e.operator){default:throw new r.VirtualMachineError(this.createStackTrace(),`Unknown operator: ${e.operator}`);case"push":if(void 0===e.value)throw new r.VirtualMachineError(this.createStackTrace(),`${this.getScopeLine()}: Push needs an input`);this.pushStack(e.value);break;case"toArgument":{const t=e.value??this.popStack();if(!(0,u.isIArrayValue)(t))throw new r.VirtualMachineError(this.createStackTrace(),`${this.getScopeLine()}: Unable to convert argument value onto stack: ${t.toString()}`);this.pushStack(new i.ArrayValue(t.arrayValues(),!0));break}case"get":{const t=e.value??this.popStack();if(!(t instanceof l.StringValue))throw new r.VirtualMachineError(this.createStackTrace(),`${this.getScopeLine()}: Unable to get, input must be a string not: ${t.toString()}`);let n=this._currentScope.get(t.value);if(void 0!==n){this.pushStack(n);break}if(void 0!==this.builtinScope&&(n=this.builtinScope.get(t.value),void 0!==n)){this.pushStack(n);break}throw new r.VirtualMachineError(this.createStackTrace(),`${this.getScopeLine()}: Unable to get variable: ${t.toString()}`)}case"getProperty":{const t=e.value??this.popStack();if(!(0,u.isIArrayValue)(t))throw new r.VirtualMachineError(this.createStackTrace(),`${this.getScopeLine()}: Unable to get property, input needs to be an array: ${t.toString()}`);const n=this.popStack(),o=(0,p.getProperty)(n,t);if(void 0===o)throw new r.VirtualMachineError(this.createStackTrace(),`${this.getScopeLine()}: Unable to get property: ${t.toString()}`);this.pushStack(o);break}case"define":{const t=e.value??this.popStack(),r=this.popStack();this._currentScope.tryDefine(t.toString(),r);break}case"set":{const t=e.value??this.popStack(),n=this.popStack();if(!this._currentScope.trySet(t.toString(),n))throw new r.VirtualMachineError(this.createStackTrace(),`${this.getScopeLine()}: Unable to set variable that has not been defined: ${t.toString()} = ${n.toString()}`);break}case"jumpFalse":{const t=e.value??this.popStack();0===this.popStack().compareTo(a.BoolValue.False)&&this.jump(t.toString());break}case"jumpTrue":{const t=e.value??this.popStack();0===this.popStack().compareTo(a.BoolValue.True)&&this.jump(t.toString());break}case"jump":{const t=e.value??this.popStack();this.jump(t.toString());break}case"return":this.callReturn();break;case"call":{if(!(e.value instanceof c.NumberValue))throw new r.VirtualMachineError(this.createStackTrace(),`${this.getScopeLine()}: Call needs a num args code line input`);const t=e.value,n=this.popStack();if(!(0,u.isIFunctionValue)(n))throw new r.VirtualMachineError(this.createStackTrace(),`${this.getScopeLine()}: Call needs a function to run: ${n.toString()}`);this.callFunction(n,t.value,!0);break}case"callDirect":{const t=e.value;if(!(null!=t&&(0,u.isIArrayValue)(t)&&(0,u.isIFunctionValue)(t.tryGetIndex(0))&&t.tryGetIndex(1)instanceof c.NumberValue))throw new r.VirtualMachineError(this.createStackTrace(),`${this.getScopeLine()}: Call direct needs an array of the function and num args code line input`);this.callFunction(t.tryGetIndex(0),t.tryGetIndex(1).value,!0);break}case"stringConcat":{if(!(0,c.isNumberValue)(e.value))throw new r.VirtualMachineError(this.createStackTrace(),`${this.getScopeLine()}: StringConcat operator needs the number of args to concat`);const t=this.getArgs(e.value.value);this.pushStackString(t.value.join(""));break}case"+":this.pushStackNumber(this.getNumArg(e)+this.popStackNumber());break;case"-":{const t=this.getNumArg(e),r=this.popStackNumber();this.pushStackNumber(r-t);break}case"unaryNegative":this.pushStackNumber(-this.popStackNumber());break;case"*":this.pushStackNumber(this.getNumArg(e)*this.popStackNumber());break;case"/":{const t=this.getNumArg(e),r=this.popStackNumber();this.pushStackNumber(r/t);break}case"++":{if(null==e.value)throw new r.VirtualMachineError(this.createStackTrace(),`${this.getScopeLine()}: Inc operator needs code line variable`);const t=e.value.toString(),n=this._currentScope.getNumber(t);if(void 0===n)throw new r.VirtualMachineError(this.createStackTrace(),`${this.getScopeLine()}: Inc operator could not find variable: ${t}`);this._currentScope.trySet(t,new c.NumberValue(n+1));break}case"--":{if(null==e.value)throw new r.VirtualMachineError(this.createStackTrace(),`${this.getScopeLine()}: Dec operator needs code line variable`);const t=e.value.toString(),n=this._currentScope.getNumber(t);if(void 0===n)throw new r.VirtualMachineError(this.createStackTrace(),`${this.getScopeLine()}: Dec operator could not find variable: ${t}`);this._currentScope.trySet(t,new c.NumberValue(n-1));break}case"<":{const t=e.value??this.popStack(),r=this.popStack();this.pushStackBool(r.compareTo(t)<0);break}case"<=":{const t=e.value??this.popStack(),r=this.popStack();this.pushStackBool(r.compareTo(t)<=0);break}case"==":{const t=e.value??this.popStack(),r=this.popStack();this.pushStackBool(0==r.compareTo(t));break}case"!=":{const t=e.value??this.popStack(),r=this.popStack();this.pushStackBool(0!=r.compareTo(t));break}case">":{const t=e.value??this.popStack(),r=this.popStack();this.pushStackBool(r.compareTo(t)>0);break}case">=":{const t=e.value??this.popStack(),r=this.popStack();this.pushStackBool(r.compareTo(t)>=0);break}case"&&":this.pushStackBool(this.getBoolArg(e)&&this.popStackBool());break;case"||":this.pushStackBool(this.getBoolArg(e)||this.popStackBool());break;case"!":this.pushStackBool(!this.popStackBool())}}tryCallReturn(){const e=this._stackTrace.pop();return null!=e&&(this._currentScope=e.scope,this._lineCounter=e.lineNumber,this.currentCode=e.function,!0)}callReturn(){if(!this.tryCallReturn())throw new r.VirtualMachineError(this.createStackTrace(),`${this.getScopeLine()}: Unable to return, call stack empty`)}getArgs(e){if(0===e)return i.ArrayValue.Empty;let t=!1;const r=new Array(e);for(let n=0;n<e;n++){const o=this.popStack();o instanceof i.ArrayValue&&o.isArgumentValue&&(t=!0),r[e-n-1]=o}if(t){let e=[];for(const t of r)t instanceof i.ArrayValue&&t.isArgumentValue?e=e.concat(t.value):e.push(t);return new i.ArrayValue(e,!0)}return new i.ArrayValue(r,!0)}getNumArg(e){if(null==e.value)return this.popStackNumber();if((0,c.isNumberValue)(e.value))return e.value.value;throw new r.VirtualMachineError(this.createStackTrace(),`${this.getScopeLine()}: Error attempt to get number argument`)}getBoolArg(e){if(null==e.value)return this.popStackBool();if((0,a.isBoolValue)(e.value))return e.value.value;throw new r.VirtualMachineError(this.createStackTrace(),`${this.getScopeLine()}: Error attempt to get boolean argument`)}jump(e){const t=this.currentCode.labels[e];if(null==t)throw new r.VirtualMachineError(this.createStackTrace(),`${this.getScopeLine()}: Unable to jump to label: ${e}`);this._lineCounter=t}callFunction(e,t,r){const n=this.getArgs(t);e.invoke(this,n,r)}executeFunction(e,t,n=!1){n&&this.pushCurrentToStackTrace(),this.currentCode=e,this._currentScope=new o.Scope(this._currentScope),this._lineCounter=0;const a=Math.min(t.value.length,e.parameters.length);let u=0;for(;u<a;u++){const r=e.parameters[u];if(r.startsWith("...")){t=(0,s.sublist)(t,u,-1),this._currentScope.tryDefine(r.substring(3),t),u++;break}this._currentScope.tryDefine(r,t.value[u])}if(u<e.parameters.length){const t=e.parameters[u];if(!t.startsWith("..."))throw new r.VirtualMachineError(this.createStackTrace(),"Function called without enough arguments: "+e.name);this._currentScope.tryDefine(t.substring(3),i.ArrayValue.Empty)}}pushCurrentToStackTrace(){this.pushToStackTrace({lineNumber:this._lineCounter,scope:this._currentScope,function:this.currentCode})}pushToStackTrace(e){if(this._stackTrace.length>=this._stackSize)throw new r.VirtualMachineError(this.createStackTrace(),`${this.getScopeLine()}: Unable to push to stack trace, stack is full`);this._stackTrace.push(e)}pushStack(e){if(this._stack.length>=this._stackSize)throw new r.VirtualMachineError(this.createStackTrace(),`${this.getScopeLine()}: Unable to push, stack full`);this._stack.push(e)}pushStackNumber(e){this.pushStack(new c.NumberValue(e))}pushStackString(e){this.pushStack(new l.StringValue(e))}pushStackBool(e){this.pushStack(new a.BoolValue(e))}popStack(){const e=this._stack.pop();if(void 0===e)throw new r.VirtualMachineError(this.createStackTrace(),`${this.getScopeLine()}: Popped empty stack`);return e}popStackCast(e){const t=this.popStack();if(e(t))return t;throw new r.VirtualMachineError(this.createStackTrace(),`${this.getScopeLine()}: Pop stack cast error`)}popStackNumber(){const e=this._stack.pop();if(!(0,c.isNumberValue)(e))throw new r.VirtualMachineError(this.createStackTrace(),`${this.getScopeLine()}: Pop stack error, not a number`);return e.value}popStackBool(){const e=this._stack.pop();if(!(0,a.isBoolValue)(e))throw new r.VirtualMachineError(this.createStackTrace(),`${this.getScopeLine()}: Pop stack error, not a boolean`);return e.value}peekStack(){if(0===this._stack.length)throw new r.VirtualMachineError(this.createStackTrace(),`${this.getScopeLine()}: Peek empty stack`);return this._stack[this._stack.length-1]}createStackTrace(){const e=[this.debugScopeLine(this.currentCode,this._lineCounter-1)];for(let t=this.stackTrace.length-1;t>=0;t--){const r=this._stackTrace[t];e.push(this.debugScopeLine(r.function,r.lineNumber))}return e}debugScopeLine(e,t){let r=`  at [${e.name}] in ${e.debugSymbols.sourceName}`;if(t>=e.code.length)return`${r} end of code`;if(t<0)return`${r} before start of code`;const n=e.debugSymbols.getLocation(t);r+=`:${n.startLineNumber+1}:${n.startColumnNumber}\n`;const o=Math.max(0,n.startLineNumber-1),s=Math.min(e.debugSymbols.fullText.length,n.startLineNumber+2);for(let t=o;t<s;t++){const o=(t+1).toString(10);if(r+=`${o}: ${e.debugSymbols.fullText[t]}\n`,t===n.startLineNumber){r+=" ".repeat(n.startColumnNumber+o.length)+"^";const e=n.endColumnNumber-n.startColumnNumber;e>0&&(r+="-".repeat(e)+"^"),r+="\n"}}return r}getScopeLine(){return`${this.currentCode.name}:${this._lineCounter}`}}})),n.register("bLFXl",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.VirtualMachineError=e.exports.AssemblerError=e.exports.ParserError=void 0;var r=n("2mTEf");class o extends Error{constructor(e,t,r){super(r),this.location=e,this.token=t}}e.exports.ParserError=o;class s extends Error{constructor(e,t){super(`${(0,r.toStringCodeLocation)(e.location)}: ${e.toString()}: ${t}`),this.token=e}}e.exports.AssemblerError=s;class i extends Error{constructor(e,t){super(t),this.stackTrace=e}}e.exports.VirtualMachineError=i})),n.register("6PleH",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.Scope=void 0;var r=n("evteC"),o=n("bDrYL");class s{constructor(e){this._values={},this._parent=e}get values(){return this._values}get constants(){return this._constants??s.EmptyConstants}get parent(){return this._parent}combineScope(e){for(const t in e.values)this.tryDefine(t,e.values[t]);for(const t in e.constants)this.setConstant(t)}trySetConstant(e,t){return null==this._values[e]&&(this.tryDefine(e,t),this.setConstant(e),!0)}trySetConstantFunc(e,t,n=null){return this.trySetConstant(e,new r.BuiltinFunctionValue(t,n??e))}tryDefine(e,t){return!this.isConstant(e)&&(this._values[e]=t,!0)}tryDefineFunc(e,t,n=null){return this.tryDefine(e,new r.BuiltinFunctionValue(t,n??e))}trySet(e,t){return!this.isConstant(e)&&(this._values.hasOwnProperty(e)?(this._values[e]=t,!0):!!this._parent&&this._parent.trySet(e,t))}get(e){const t=this._values[e];return null!=t?t:void 0!==this._parent?this._parent.get(e):void 0}getNumber(e){const t=this.get(e);if((0,o.isNumberValue)(t))return t.value}setConstant(e){void 0===this._constants&&(this._constants={}),this._constants[e]=!0}isConstant(e){return!!this._constants&&!0===this._constants[e]}}e.exports.Scope=s,s.Empty=new s(void 0),s.EmptyConstants={}})),n.register("evteC",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.BuiltinFunctionValue=void 0;class r{constructor(e,t){this.value=e,this.name=t}typename(){return"builtin-function"}toString(){return`builtin-function:${this.name}`}compareTo(e){return e instanceof r&&this.value===e.value?0:1}invoke(e,t,r){this.value(e,t)}}e.exports.BuiltinFunctionValue=r})),n.register("bDrYL",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.isNumberValue=e.exports.numberCompareTo=e.exports.NumberValue=void 0;class r{constructor(e){this.value=e}typename(){return"number"}toString(){return this.value.toString()}compareTo(e){return e instanceof r?n(this.value,e.value):1}}function n(e,t){const r=e-t;return Math.abs(r)<1e-4?0:r<0?-1:1}e.exports.NumberValue=r,e.exports.numberCompareTo=n,e.exports.isNumberValue=function(e){return e instanceof r}})),n.register("2n3io",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.sublist=e.exports.indexOf=e.exports.contains=e.exports.removeAll=e.exports.remove=e.exports.removeAt=e.exports.insertFlatten=e.exports.insert=e.exports.get=e.exports.set=e.exports.createArrayScope=e.exports.arrayScope=void 0;var r=n("6PleH"),o=n("iIv5n"),s=n("evteC"),i=n("aoVf1"),a=n("g0lkP"),u=n("5dKj2");function c(){const e=new r.Scope,t={join:new s.BuiltinFunctionValue(((e,t)=>{e.pushStack(new o.ArrayValue(t.value))}),"array.join"),length:new s.BuiltinFunctionValue(((e,t)=>{const r=t.getIndexCast(0,o.isArrayValue);e.pushStackNumber(r.arrayValues().length)}),"array.length"),get:new s.BuiltinFunctionValue(((e,t)=>{const r=p(t.getIndexCast(0,o.isArrayValue),t.getNumber(1));void 0!==r?e.pushStack(r):e.pushStack(a.NullValue.Value)}),"array.get"),set:new s.BuiltinFunctionValue(((e,t)=>{const r=t.getIndexCast(0,o.isArrayValue),n=t.getNumber(1),s=t.getIndex(2);e.pushStack(l(r,n,s))}),"array.set"),insert:new s.BuiltinFunctionValue(((e,t)=>{const r=t.getIndexCast(0,o.isArrayValue),n=t.getNumber(1),s=t.getIndex(2);e.pushStack(h(r,n,s))}),"array.insert"),insertFlatten:new s.BuiltinFunctionValue(((e,t)=>{const r=t.getIndexCast(0,o.isArrayValue),n=t.getNumber(1),s=t.getIndexCast(2,i.isIArrayValue);e.pushStack(g(r,n,s))}),"array.insertFlatten"),remove:new s.BuiltinFunctionValue(((e,t)=>{const r=t.getIndexCast(0,o.isArrayValue),n=t.getIndex(1);e.pushStack(b(r,n))}),"array.remove"),removeAt:new s.BuiltinFunctionValue(((e,t)=>{const r=t.getIndexCast(0,o.isArrayValue),n=t.getNumber(1);e.pushStack(m(r,n))}),"array.removeAt"),removeAll:new s.BuiltinFunctionValue(((e,t)=>{const r=t.getIndexCast(0,o.isArrayValue),n=t.getIndex(1);e.pushStack(f(r,n))}),"array.removeAll"),contains:new s.BuiltinFunctionValue(((e,t)=>{const r=t.getIndexCast(0,o.isArrayValue),n=t.getIndex(1);e.pushStackBool(S(r,n))}),"array.contains"),indexOf:new s.BuiltinFunctionValue(((e,t)=>{const r=t.getIndexCast(0,o.isArrayValue),n=t.getIndex(1);e.pushStackNumber(d(r,n))}),"array.indexOf"),sublist:new s.BuiltinFunctionValue(((e,t)=>{const r=t.getIndexCast(0,o.isArrayValue),n=t.getNumber(1),s=t.getNumber(2);e.pushStack(k(r,n,s))}),"array.sublist")};return e.tryDefine("array",new u.ObjectValue(t)),e}function l(e,t,r){let n=[...e.value];return n[e.calcIndex(t)]=r,new o.ArrayValue(n)}function p(e,t){return e.tryGetIndex(t)}function h(e,t,r){t=e.calcIndex(t);const n=[...e.value];return n.splice(t,0,r),new o.ArrayValue(n)}function g(e,t,r){t=e.calcIndex(t);const n=[...e.value];return n.splice(t,0,...r.arrayValues()),new o.ArrayValue(n)}function m(e,t){t=e.calcIndex(t);const r=[...e.value];return r.splice(t,1),new o.ArrayValue(r)}function b(e,t){const r=d(e,t);return r<0?e:m(e,r)}function f(e,t){return new o.ArrayValue(e.value.filter((e=>0!==e.compareTo(t))))}function S(e,t){return d(e,t)>=0}function d(e,t){return e.arrayValues().findIndex((e=>0===e.compareTo(t)))}function k(e,t,r){return t=e.calcIndex(t),r<0?new o.ArrayValue(e.value.slice(t)):new o.ArrayValue(e.value.slice(t,t+r))}e.exports.arrayScope=c(),e.exports.createArrayScope=c,e.exports.set=l,e.exports.get=p,e.exports.insert=h,e.exports.insertFlatten=g,e.exports.removeAt=m,e.exports.remove=b,e.exports.removeAll=f,e.exports.contains=S,e.exports.indexOf=d,e.exports.sublist=k})),n.register("iIv5n",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.isArrayValue=e.exports.arrayCompareTo=e.exports.ArrayValue=void 0;var r=n("hxs7z"),o=n("bDrYL"),s=n("4dh1X");const i=["length"];class a{constructor(e,t=!1){this.value=e,this.isArgumentValue=t}typename(){return this.isArgumentValue?"arguments":"array"}toString(){let e=!0,t="(";for(const r of this.value)e||(t+=" "),e=!1,t+=r.toString();return t+=")",t}arrayValues(){return this.value}compareTo(e){return this===e?0:e instanceof a?u(this,e):1}calcIndex(e){return e<0?this.value.length+e:e}tryGetIndex(e){return this.value[this.calcIndex(e)]}getIndex(e){if(e<0||e>=this.value.length)throw new Error("Out of index");return this.value[e]}getIndexCast(e,t){const r=this.value[e];if(t(r))return r;throw new Error(`Unable to get argument: [${e}] failed guard check`)}getNumber(e){return this.getIndexCast(e,o.isNumberValue).value}getString(e){return this.getIndexCast(e,s.isStringValue).value}getBool(e){return this.getIndexCast(e,r.isBoolValue).value}tryGetKey(e){if("length"===e)return new o.NumberValue(this.value.length)}objectKeys(){return i}}function u(e,t){const r=e.arrayValues(),n=t.arrayValues(),s=(0,o.numberCompareTo)(r.length,n.length);if(0!==s)return s;for(let e=0;e<r.length;e++){const t=r[e].compareTo(n[e]);if(0!==t)return t}return 0}e.exports.ArrayValue=a,a.Empty=new a([],!1),a.EmptyArgs=new a([],!0),e.exports.arrayCompareTo=u,e.exports.isArrayValue=function(e){return void 0!==e&&e instanceof a}})),n.register("hxs7z",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.isBoolValue=e.exports.boolCompareTo=e.exports.BoolValue=void 0;class r{constructor(e){this.value=e}typename(){return"boolean"}toString(){return this.value?"true":"false"}compareTo(e){return e instanceof r?n(this.value,e.value):1}}function n(e,t){return e===t?0:e?-1:1}e.exports.BoolValue=r,r.True=new r(!0),r.False=new r(!1),e.exports.boolCompareTo=n,e.exports.isBoolValue=function(e){return e instanceof r}})),n.register("4dh1X",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.isStringValue=e.exports.StringValue=void 0;var r=n("bDrYL");const o=["length"];class s{constructor(e){this.value=e}typename(){return"string"}toString(){return this.value}compareTo(e){if(!(e instanceof s))return 1;const t=this.value.localeCompare(e.value);return 0==t?0:t<0?-1:1}getIndex(e){return e<0?this.value.length+e:e}tryGetKey(e){if("length"===e)return new r.NumberValue(this.value.length)}objectKeys(){return o}}e.exports.StringValue=s,e.exports.isStringValue=function(e){return e instanceof s}})),n.register("aoVf1",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.isIFunctionValue=e.exports.isIObjectValue=e.exports.isIArrayValue=void 0,e.exports.isIArrayValue=function(e){return void 0!==e&&"function"==typeof e.arrayValues},e.exports.isIObjectValue=function(e){return void 0!==e&&"function"==typeof e.objectKeys},e.exports.isIFunctionValue=function(e){return void 0!==e&&"function"==typeof e.invoke}})),n.register("g0lkP",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.NullValue=void 0;class r{typename(){return"null"}toString(){return"null"}compareTo(e){return e instanceof r?0:1}}e.exports.NullValue=r,r.Value=new r})),n.register("5dKj2",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.isObjectValue=e.exports.ObjectValue=void 0;var r=n("bDrYL");class o{constructor(e){this.value=e,this.keys=Object.keys(e)}typename(){return"object"}toString(){let e=!0,t="{";for(const r in this.value)e||(t+=" "),e=!1,t+=`"${r}" `,t+=this.value[r].toString();return t+="}",t}compareTo(e){if(this===e)return 0;if(!(e instanceof o))return 1;const t=(0,r.numberCompareTo)(this.keys.length,e.keys.length);if(0!==t)return t;for(const t in this.value){const r=e.value[t];if(void 0===r)return 1;const n=this.value[t].compareTo(r);if(0!==n)return n}return 0}tryGetKey(e){return this.value[e]}objectKeys(){return this.keys}}e.exports.ObjectValue=o,e.exports.isObjectValue=function(e){return void 0!==e&&e instanceof o}})),n.register("4OWy8",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.parseIndex=e.exports.getProperty=void 0;var r=n("aoVf1"),o=n("bDrYL"),s=n("4dh1X"),i=n("k9sml");function a(e){if(e instanceof o.NumberValue)return e.value;if(e instanceof s.StringValue||e instanceof i.VariableValue){const t=parseInt(e.value);return isFinite(t)?t:void 0}}e.exports.getProperty=function(e,t){const n=t.arrayValues();for(let t=0;t<n.length;t++){const o=a(n[t]);if(void 0!==o&&(0,r.isIArrayValue)(e)){const t=e.tryGetIndex(o);if(void 0===t)return;e=t}else{if(!(0,r.isIObjectValue)(e))return;{const r=e.tryGetKey(n[t].toString());if(void 0===r)return;e=r}}}return e},e.exports.parseIndex=a})),n.register("k9sml",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.VariableValue=void 0;class r{constructor(e){this.value=e}get isLabel(){return this.value.length>0&&":"===this.value[0]}typename(){return"variable"}toString(){return this.value}compareTo(e){if(!(e instanceof r))return 1;const t=this.value.localeCompare(e.value);return 0==t?0:t<0?-1:1}}e.exports.VariableValue=r})),n.register("2fEeR",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.VMFunction=e.exports.DebugSymbols=void 0;var r=n("2mTEf");class o{constructor(e,t,r){this.sourceName=e,this.fullText=t,this.codeLineToText=r}getLocation(e){return e>=0&&e<this.codeLineToText.length?this.codeLineToText[e]:r.EmptyCodeLocation}}e.exports.DebugSymbols=o,o.empty=new o("empty",[],[]);class s{constructor(e,t,r,n,o){this.code=e,this.parameters=t,this.labels=r,this.name=n.length>0?n:"anonymous",this.debugSymbols=o,this.hasName=n.length>0}get isEmpty(){return 0==this.code.length}}e.exports.VMFunction=s,s.Empty=new s([],[],{},"",o.empty)})),n.register("e6hMN",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.Assembler=void 0;var r=n("bLFXl"),o=n("iEt6a"),s=n("6PleH"),i=n("ldWkU"),a=n("4dh1X"),u=n("4OWy8"),c=n("2mTEf"),l=n("2fEeR"),p=n("8xi8G"),h=n("jyc5U");const g="function",m="continue",b="break",f="unless";function S(e,t){return{operator:e,value:t}}function d(e){return{label:e}}function k(e,t){for(let r=0;r<t.length;r++)e.push(t[r])}function v(e,t){t.isNestedExpression()?k(e,t.tokenList):e.push(t)}class x{constructor(){this.builtinScope=new s.Scope,this.labelCount=0,this.loopStack=[],this.keywordParsingStack=[],this.constScope=new s.Scope,this.sourceName="",this.fullText=[""]}parseFromText(e,t){this.sourceName=e,this.fullText=function(e){return e.split(/\r?\n/)}(t),this.constScope=new s.Scope;const r=p.Lexer.readFromLines(this.fullText),n=this.parseGlobalFunction(r),o=new s.Scope;return o.combineScope(this.builtinScope),o.combineScope(this.constScope),new i.Script(o,n)}parse(e){if("expression"===e.type){if(0===e.tokenList.length)return[];const t=e.tokenList[0];if(t.value instanceof o.VariableValue){const r=t.toString();if(t.value.isLabel)return[d(r)];const n=this.parseKeyword(r,e);if(n.length>0)return function(e){return 1===e.length&&"unknown"===e[0].operator}(n)?[]:n;this.keywordParsingStack.push("func-call");let o=e.tokenList.slice(1).map((e=>this.parse(e))).flat(1);return k(o,this.optimiseCallSymbolValue(t,e.tokenList.length-1)),this.keywordParsingStack.pop(),o}throw new r.AssemblerError(e,"Expression needs to start with a function variable")}if("list"===e.type){const t=[];for(const n of e.tokenList){const e=this.parse(n);if(0!==e.length){if(1!==e.length||"push"!==e[0].operator||void 0===e[0].value)throw new r.AssemblerError(e[0].value,"Unexpected token in list literal");t.push(e[0].value.getValue())}}return[S("push",e.keepLocation(new o.ArrayValue(t,!1)))]}if("map"===e.type){const t={};for(const n in e.tokenMap){const o=e.tokenMap[n],s=this.parse(o);if(0!==s.length){if(1!==s.length||"push"!==s[0].operator||void 0===s[0].value)throw new r.AssemblerError(s[0].value,"Unexpected token in map literal");t[n]=s[0].value.getValue()}}return[S("push",e.keepLocation(new o.ObjectValue(t)))]}return e.value instanceof o.VariableValue&&!e.value.isLabel?this.optimiseGetSymbolValue(e):[S("push",e)]}parseDefineSet(e,t){const n=t?"define":"set",o=this.parse(e.tokenList[e.tokenList.length-1]);for(let t=e.tokenList.length-2;t>=1;t--){const s=e.tokenList[t].getValue().toString();if(void 0!==this.constScope.get(s))throw new r.AssemblerError(e.tokenList[t],`Attempting to ${n} a constant: ${s}`);o.push(S(n,e.tokenList[t]))}return o}parseConst(e){if(2!=e.tokenList.length)throw new r.AssemblerError(e,"Const requires 2 inputs");const t=this.parse(e.tokenList[e.tokenList.length-1]);if(1!==t.length||"push"!==t[0].operator||void 0===t[0].value)throw new r.AssemblerError(e,"Const value is not a compile time constant");const n=e.tokenList[1].getValue().toString();if(!this.constScope.trySetConstant(n,t[0].value.getValue()))throw new r.AssemblerError(e,"Cannot redefine a constant");return t}parseLoop(e){if(e.tokenList.length<3)throw new r.AssemblerError(e,"Loop input has too few arguments");const t=this.labelCount++,n=`:LoopStart${t}`,o=`:LoopEnd${t}`;this.loopStack.push({start:n,end:o});const s=e.tokenList[1];let i=[d(n),...this.parse(s)];i.push(S("jumpFalse",s.keepLocation(o)));for(let t=2;t<e.tokenList.length;t++)k(i,this.parse(e.tokenList[t]));return i.push(S("jump",s.keepLocation(n))),i.push(d(o)),this.loopStack.pop(),i}parseIfUnless(e,t){if(e.tokenList.length<3)throw new r.AssemblerError(e,"Condition input has too few inputs");if(e.tokenList.length>4)throw new r.AssemblerError(e,"Condition input has too many inputs!");let n=[e.keepLocation(t?"if":f)];const s=e.tokenList[1];let i=[s];if(v(i,e.tokenList[2]),n.push(h.Token.expression(s.location,i)),4===e.tokenList.length){const t=e.tokenList[3],r=[t.keepLocation(o.BoolValue.True)];v(r,t),n.push(h.Token.expression(s.location,r))}const a=h.Token.expression(e.location,n);return this.parseSwitch(a)}parseSwitch(e){const t=this.labelCount++,r=`:CondNext${e.tokenList.length}_${t}`;let n=[];for(let s=1;s<e.tokenList.length;s++){const i=e.tokenList[s],a=`:CondNext${s}_${t}`,u=`:CondNext${s+1}_${t}`;s>1&&n.push(d(a));const c=i.tokenList[0];0!==c.value.compareTo(o.BoolValue.True)&&(k(n,this.parse(c)),n.push(S("jumpFalse",i.keepLocation(u))));for(let e=1;e<i.tokenList.length;e++)k(n,this.parse(i.tokenList[e]));s<e.tokenList.length-1&&n.push(S("jump",i.keepLocation(r)))}return n.push(d(r)),n}parseLoopJump(e,t,n){if(0===this.loopStack.length)throw new r.AssemblerError(e,`Unexpected ${t} outside of loop`);const o=this.loopStack[this.loopStack.length-1];return[S("jump",e.keepLocation(n?o.start:o.end))]}parseFunction(e){this.constScope=new s.Scope(this.constScope);let t="",n=0;(e.tokenList[1].value instanceof o.VariableValue||e.tokenList[1].value instanceof a.StringValue)&&(t=e.tokenList[1].toString(),n=1);const i=e.tokenList[1+n].tokenList.map((e=>e.getValue().toString())),u=e.tokenList.slice(2+n).map((e=>this.parse(e))).flat(1),c=this.processTempFunction(i,u,t);if(void 0===this.constScope.parent)throw new r.AssemblerError(e,"Internal error, const scope parent lost");return this.constScope=this.constScope.parent,c}parseGlobalFunction(e){const t=e.tokenList.map((e=>this.parse(e))).flat(1);return this.processTempFunction([],t,"global")}processTempFunction(e,t,r){const n={},o=[],s=[];for(const e of t)void 0!==e.label&&""!==e.label?n[e.label]=o.length:void 0!==e.operator&&void 0!==e.value&&(s.push(e.value.location),o.push({operator:e.operator,value:e.value.getValueCanBeEmpty()}));const i=new l.DebugSymbols(this.sourceName,this.fullText,s);return new l.VMFunction(o,e,n,r,i)}parseJump(e){let t=this.parse(e.tokenList[1]);return 1===t.length&&"push"===t[0].operator&&void 0!==t[0].value?[S("jump",t[0].value)]:(t.push(S("push",e.toEmpty())),t)}parseReturn(e){const t=e.tokenList.slice(1).map((e=>this.parse(e))).flat(1);return t.push(S("return",e.toEmpty())),t}parseFunctionKeyword(e){const t=this.parseFunction(e),r=new o.FunctionValue(t),n=e.keepLocation(r);if(1===this.keywordParsingStack.length&&t.hasName)return this.constScope.trySetConstant(t.name,r),[S("unknown",h.Token.empty(c.EmptyCodeLocation))];const s=[S("push",n)],i=this.keywordParsingStack.length>1?this.keywordParsingStack[this.keywordParsingStack.length-1]:g;return t.hasName&&i===g&&s.push(S("define",e.keepLocation(t.name))),s}parseNegative(e){if(e.tokenList.length>=3)return this.parseOperator("-",e);if(2===e.tokenList.length){const t=e.tokenList[1];if((0,o.isNumberValue)(t.value))return[S("push",t.keepLocation(new o.NumberValue(-t.value.value)))];const r=this.parse(t);return r.push(S("unaryNegative",t.toEmpty())),r}throw new r.AssemblerError(e,"Negative/Sub operator expects at least 1 input")}parseOnePushInput(e,t){if(t.tokenList.length<2)throw new r.AssemblerError(t,`Expecting at least 1 input for: ${e}`);let n=[];for(let r=1;r<t.tokenList.length;r++)k(n,this.parse(t.tokenList[r])),n.push(S(e,t.tokenList[r].toEmpty()));return n}parseOperator(e,t){if(t.tokenList.length<3)throw new r.AssemblerError(t,`Expecting at least 3 inputs for: ${e}`);let n=this.parse(t.tokenList[1]);for(let r=2;r<t.tokenList.length;r++){const s=t.tokenList[r];(0,o.isNumberValue)(s.value)?n.push(S(e,s)):(k(n,this.parse(s)),n.push(S(e,t.toEmpty())))}return n}parseOneVariableUpdate(e,t){if(t.tokenList.length<2)throw new r.AssemblerError(t,`Expecting at least 1 input for: ${e}`);let n=[];for(let r=1;r<t.tokenList.length;r++){const o=new a.StringValue(t.tokenList[r].getValue().toString());n.push(S(e,t.tokenList[r].keepLocation(o)))}return n}parseStringConcat(e){const t=e.tokenList.slice(1).map((e=>this.parse(e))).flat(1);return t.push(S("stringConcat",e.keepLocation(new o.NumberValue(e.tokenList.length-1)))),t}transformAssignmentOperator(e){let t=e.tokenList[0].getValue().toString();t=t.substring(0,t.length-1);const r=e.tokenList[1].getValue().toString(),n=[...e.tokenList];n[0]=e.tokenList[0].keepLocation(new o.VariableValue(t));const s=[e.keepLocation(new o.VariableValue("set")),e.keepLocation(new o.VariableValue(r)),h.Token.expression(e.location,n)];return this.parse(h.Token.expression(e.location,s))}parseKeyword(e,t){let r=null;switch(this.keywordParsingStack.push(e),e){case g:r=this.parseFunctionKeyword(t);break;case m:r=this.parseLoopJump(t,m,!0);break;case b:r=this.parseLoopJump(t,b,!1);break;case"set":r=this.parseDefineSet(t,!1);break;case"define":r=this.parseDefineSet(t,!0);break;case"const":r=this.parseConst(t);break;case"loop":r=this.parseLoop(t);break;case"if":r=this.parseIfUnless(t,!0);break;case f:r=this.parseIfUnless(t,!1);break;case"switch":r=this.parseSwitch(t);break;case"jump":r=this.parseJump(t);break;case"return":r=this.parseReturn(t);break;case"+":case"*":case"/":r=this.parseOperator(e,t);break;case"-":r=this.parseNegative(t);break;case"++":case"--":r=this.parseOneVariableUpdate(e,t);break;case"<":case"<=":case"==":case"!=":case">":case">=":case"&&":case"||":r=this.parseOperator(e,t);break;case"!":r=this.parseOnePushInput("!",t);break;case"$":r=this.parseStringConcat(t);break;case"+=":case"-=":case"*=":case"/=":case"&&=":case"||=":case"$=":r=this.transformAssignmentOperator(t)}return this.keywordParsingStack.pop(),null!=r?r:[]}optimiseCallSymbolValue(e,t){if("value"!==e.type)throw new r.AssemblerError(e,"Call token must be a value");const n=new o.NumberValue(t),s=this.optimiseGet(e,e.getValue().toString());if(1===s.length&&"push"===s[0].operator&&void 0!==s[0].value){const t=new o.ArrayValue([s[0].value.getValue(),n]);return[S("callDirect",e.keepLocation(t))]}return s.push(S("call",e.keepLocation(n))),s}optimiseGetSymbolValue(e){let t=!1,r=e.getValue().toString();r.startsWith("...")&&(t=!0,r=r.substring(3));const n=this.optimiseGet(e,r);return t&&n.push(S("toArgument",e.toEmpty())),n}optimiseGet(e,t){if("value"!==e.type)throw new r.AssemblerError(e,"Get symbol token must be a value");const n=[],o=this.constScope.get(t);if(void 0!==o)return n.push(S("push",e.keepLocation(o))),n;const s=x.isGetPropertyRequest(t),i=this.builtinScope.get(s.parentKey);if(void 0!==i)if(s.isPropertyRequest){const t=(0,u.getProperty)(i,s.property);void 0!==t?n.push(S("push",e.keepLocation(t))):(n.push(S("push",e.keepLocation(i))),n.push(S("getProperty",e.keepLocation(s.property))))}else s.isPropertyRequest||n.push(S("push",e.keepLocation(i)));else n.push(S("get",e.keepLocation(s.parentKey))),s.isPropertyRequest&&n.push(S("getProperty",e.keepLocation(s.property)));return n}static isGetPropertyRequest(e){if(e.includes(".")){const t=e.split(".");return{isPropertyRequest:!0,parentKey:t[0],property:new o.ArrayValue(t.slice(1).map((e=>new o.VariableValue(e))))}}return{isPropertyRequest:!1,parentKey:e,property:o.ArrayValue.Empty}}}e.exports.Assembler=x})),n.register("iEt6a",(function(e,t){var r=e.exports&&e.exports.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=e.exports&&e.exports.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(e.exports,"__esModule",{value:!0}),o(n("2mTEf"),e.exports),o(n("e6hMN"),e.exports),o(n("6PleH"),e.exports),o(n("bLFXl"),e.exports),o(n("ldWkU"),e.exports),o(n("2fEeR"),e.exports),o(n("kzUiW"),e.exports),o(n("1kGNJ"),e.exports),o(n("eeeBG"),e.exports)})),n.register("ldWkU",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.Script=void 0;var r=n("6PleH"),o=n("2fEeR");class s{constructor(e,t){this.builtinScope=e,this.code=t}}e.exports.Script=s,s.Empty=new s(r.Scope.Empty,o.VMFunction.Empty)})),n.register("kzUiW",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.VirtualMachineRunner=void 0;e.exports.VirtualMachineRunner=class{constructor(e){this.running=!1,this.waitUntil=-1,this.vmStepTiming=-1,this.isWaiting=!1,this.interval=-1,this.onComplete=()=>{},this.onError=()=>{},this.step=e=>{if(!this.running)return;let t=!1;for(;this._vm.running&&!this._vm.paused;){if(this.waitUntil>0){if(this.waitUntil-=e,t||this.waitUntil>0)break;this.waitUntil=this.vmStepTiming}else this.waitUntil=this.vmStepTiming;t=!0,this.isWaiting=!1;try{this._vm.step()}catch(e){this.running=!1,this.onError(e)}}this._vm.running||(this.running=!1,this.onComplete(null),clearInterval(this.interval))},this._vm=e}get vm(){return this._vm}start(e=1e3/60){return this.running=!0,this._vm.running=!0,this.interval=setInterval(this.step,e,e),new Promise(((e,t)=>{this.onComplete=e,this.onError=t}))}}})),n.register("1kGNJ",(function(e,t){var r=e.exports&&e.exports.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=e.exports&&e.exports.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(e.exports,"__esModule",{value:!0}),o(n("iIv5n"),e.exports),o(n("hxs7z"),e.exports),o(n("evteC"),e.exports),o(n("eUVip"),e.exports),o(n("aoVf1"),e.exports),o(n("g0lkP"),e.exports),o(n("bDrYL"),e.exports),o(n("5dKj2"),e.exports),o(n("4dh1X"),e.exports),o(n("k9sml"),e.exports)})),n.register("eUVip",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.FunctionValue=void 0;class r{constructor(e){this.value=e}typename(){return"function"}toString(){return"function:"+this.value.name}compareTo(e){return this===e||e instanceof r&&this.value===e.value?0:1}invoke(e,t,r){e.executeFunction(this.value,t,r)}}e.exports.FunctionValue=r})),n.register("eeeBG",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.addToScope=e.exports.LibraryType=e.exports.miscScope=e.exports.objectScope=e.exports.arrayScope=e.exports.stringScope=e.exports.mathScope=void 0;var r=n("iTXlX"),o=n("fN49V"),s=n("2n3io"),i=n("4uGgY"),a=n("f6Hda");r=n("iTXlX");Object.defineProperty(e.exports,"mathScope",{enumerable:!0,get:function(){return r.mathScope}});o=n("fN49V");Object.defineProperty(e.exports,"stringScope",{enumerable:!0,get:function(){return o.stringScope}});s=n("2n3io");Object.defineProperty(e.exports,"arrayScope",{enumerable:!0,get:function(){return s.arrayScope}});i=n("4uGgY");Object.defineProperty(e.exports,"objectScope",{enumerable:!0,get:function(){return i.objectScope}});var u,c;a=n("f6Hda");Object.defineProperty(e.exports,"miscScope",{enumerable:!0,get:function(){return a.miscScope}}),(c=u=e.exports.LibraryType||(e.exports.LibraryType={}))[c.math=1]="math",c[c.string=2]="string",c[c.array=4]="array",c[c.object=8]="object",c[c.misc=16]="misc",c[c.all=31]="all",e.exports.addToScope=function(e,t){t&u.math&&e.combineScope(r.mathScope),t&u.string&&e.combineScope(o.stringScope),t&u.array&&e.combineScope(s.arrayScope),t&u.object&&e.combineScope(i.objectScope),t&u.misc&&e.combineScope(a.miscScope)}})),n.register("iTXlX",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.createMathScope=e.exports.mathScope=void 0;var r=n("6PleH"),o=n("evteC"),s=n("bDrYL"),i=n("5dKj2");const a=Math.PI/180;function u(){const e=new r.Scope,t={E:new s.NumberValue(Math.E),PI:new s.NumberValue(Math.PI),DegToRad:new s.NumberValue(a),sin:new o.BuiltinFunctionValue(((e,t)=>{e.pushStackNumber(Math.sin(t.getNumber(0)))}),"math.sin"),cos:new o.BuiltinFunctionValue(((e,t)=>{e.pushStackNumber(Math.cos(t.getNumber(0)))}),"math.cos"),tan:new o.BuiltinFunctionValue(((e,t)=>{e.pushStackNumber(Math.tan(t.getNumber(0)))}),"math.tan"),exp:new o.BuiltinFunctionValue(((e,t)=>{e.pushStackNumber(Math.exp(t.getNumber(0)))}),"math.exp"),ceil:new o.BuiltinFunctionValue(((e,t)=>{e.pushStackNumber(Math.ceil(t.getNumber(0)))}),"math.ceil"),floor:new o.BuiltinFunctionValue(((e,t)=>{e.pushStackNumber(Math.floor(t.getNumber(0)))}),"math.floor"),round:new o.BuiltinFunctionValue(((e,t)=>{e.pushStackNumber(Math.round(t.getNumber(0)))}),"math.round"),isFinite:new o.BuiltinFunctionValue(((e,t)=>{e.pushStackBool(Number.isFinite(t.getNumber(0)))}),"math.isFinite"),isNaN:new o.BuiltinFunctionValue(((e,t)=>{e.pushStackBool(isNaN(t.getNumber(0)))}),"math.isNaN"),parse:new o.BuiltinFunctionValue(((e,t)=>{const r=t.getIndex(0);(0,s.isNumberValue)(r)?e.pushStack(r):e.pushStackNumber(parseFloat(r.toString()))}),"math.parse"),log:new o.BuiltinFunctionValue(((e,t)=>{e.pushStackNumber(Math.log(t.getNumber(0)))}),"math.log"),abs:new o.BuiltinFunctionValue(((e,t)=>{e.pushStackNumber(Math.abs(t.getNumber(0)))}),"math.abs"),max:new o.BuiltinFunctionValue(((e,t)=>{let r=t.value[0];for(let e=1;e<t.value.length;e++){const n=t.value[e];n.compareTo(r)>0&&(r=n)}e.pushStack(r)}),"math.max"),min:new o.BuiltinFunctionValue(((e,t)=>{let r=t.value[0];for(let e=1;e<t.value.length;e++){const n=t.value[e];n.compareTo(r)<0&&(r=n)}e.pushStack(r)}),"math.min"),sum:new o.BuiltinFunctionValue(((e,t)=>{let r=0;for(let e=0;e<t.value.length;e++){const n=t.value[e];if(!(0,s.isNumberValue)(n))throw new Error("Addition operator expects all numbers");r+=n.value}e.pushStackNumber(r)}),"math.sum")};return e.tryDefine("math",new i.ObjectValue(t)),e}e.exports.mathScope=u(),e.exports.createMathScope=u})),n.register("fN49V",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.substring=e.exports.removeAll=e.exports.removeAt=e.exports.insert=e.exports.set=e.exports.createStringScope=e.exports.stringScope=void 0;var r=n("6PleH"),o=n("evteC"),s=n("5dKj2"),i=n("4dh1X");function a(){const e=new r.Scope,t={join:new o.BuiltinFunctionValue(((e,t)=>{if(t.value.length<2)throw new Error("Not enough arguments for string join");const r=t.value[0],n=t.value.slice(1).join(r.toString());e.pushStackString(n)}),"string.join"),length:new o.BuiltinFunctionValue(((e,t)=>{const r=t.getString(0);e.pushStackNumber(r.length)}),"string.length"),get:new o.BuiltinFunctionValue(((e,t)=>{const r=t.getIndexCast(0,i.isStringValue),n=t.getNumber(1);e.pushStackString(r.value[r.getIndex(n)])}),"string.get"),set:new o.BuiltinFunctionValue(((e,t)=>{const r=t.getIndexCast(0,i.isStringValue),n=t.getNumber(1),o=t.getIndex(2).toString();e.pushStack(u(r,n,o))}),"string.set"),insert:new o.BuiltinFunctionValue(((e,t)=>{const r=t.getIndexCast(0,i.isStringValue),n=t.getNumber(1),o=t.getIndex(2).toString();e.pushStack(c(r,n,o))}),"string.insert"),substring:new o.BuiltinFunctionValue(((e,t)=>{const r=t.getIndexCast(0,i.isStringValue),n=t.getNumber(1),o=t.getNumber(2);e.pushStack(h(r,n,o))}),"string.substring"),removeAt:new o.BuiltinFunctionValue(((e,t)=>{const r=t.getIndexCast(0,i.isStringValue),n=t.getNumber(1);e.pushStack(l(r,n))}),"string.removeAt"),removeAll:new o.BuiltinFunctionValue(((e,t)=>{const r=t.getIndexCast(0,i.isStringValue),n=t.getIndex(1).toString();e.pushStack(p(r,n))}),"string.removeAll")};return e.tryDefine("string",new s.ObjectValue(t)),e}function u(e,t,r){return t=e.getIndex(t),new i.StringValue(`${e.value.substring(0,t)}${r}${e.value.substring(t+1)}`)}function c(e,t,r){return t=e.getIndex(t),new i.StringValue(`${e.value.substring(0,t)}${r}${e.value.substring(t)}`)}function l(e,t){return t=e.getIndex(t),new i.StringValue(`${e.value.substring(0,t)}${e.value.substring(t+1)}`)}function p(e,t){return new i.StringValue(e.value.replace(t,""))}function h(e,t,r){return t=e.getIndex(t),new i.StringValue(e.value.substring(t,t+r))}e.exports.stringScope=a(),e.exports.createStringScope=a,e.exports.set=u,e.exports.insert=c,e.exports.removeAt=l,e.exports.removeAll=p,e.exports.substring=h})),n.register("4uGgY",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.length=e.exports.values=e.exports.removeValues=e.exports.removeKey=e.exports.keys=e.exports.get=e.exports.set=e.exports.join=e.exports.createObjectScope=e.exports.objectScope=void 0;var r=n("6PleH"),o=n("iIv5n"),s=n("evteC"),i=n("aoVf1"),a=n("g0lkP"),u=n("5dKj2"),c=n("4dh1X");function l(){const e=new r.Scope,t={join:new s.BuiltinFunctionValue(((e,t)=>{e.pushStack(p(t))}),"object.join"),set:new s.BuiltinFunctionValue(((e,t)=>{const r=t.getIndexCast(0,u.isObjectValue),n=t.getString(1),o=t.getIndex(2);e.pushStack(h(r,n,o))}),"object.set"),get:new s.BuiltinFunctionValue(((e,t)=>{const r=g(t.getIndexCast(0,u.isObjectValue),t.getString(1));void 0!==r?e.pushStack(r):e.pushStack(a.NullValue.Value)}),"object.get"),removeKey:new s.BuiltinFunctionValue(((e,t)=>{const r=t.getIndexCast(0,u.isObjectValue),n=t.getString(1);e.pushStack(b(r,n))}),"object.removeKey"),removeValues:new s.BuiltinFunctionValue(((e,t)=>{const r=t.getIndexCast(0,u.isObjectValue),n=t.getIndex(1);e.pushStack(f(r,n))}),"object.removeValues"),keys:new s.BuiltinFunctionValue(((e,t)=>{const r=t.getIndexCast(0,u.isObjectValue);e.pushStack(m(r))}),"object.keys"),values:new s.BuiltinFunctionValue(((e,t)=>{const r=t.getIndexCast(0,u.isObjectValue);e.pushStack(S(r))}),"object.values"),length:new s.BuiltinFunctionValue(((e,t)=>{const r=t.getIndexCast(0,u.isObjectValue);e.pushStackNumber(d(r))}),"object.length")};return e.tryDefine("object",new u.ObjectValue(t)),e}function p(e){const t={},r=e.arrayValues();for(let e=0;e<r.length;e++){const n=r[e];if((0,c.isStringValue)(n)){const o=n.value,s=r[++e];t[o]=s}else if((0,i.isIObjectValue)(n))for(const e of n.objectKeys()){const r=n.tryGetKey(e);void 0!==r&&(t[e]=r)}else{const o=n.toString(),s=r[++e];t[o]=s}}return new u.ObjectValue(t)}function h(e,t,r){return new u.ObjectValue({...e.value,[t]:r})}function g(e,t){const r=e.value[t];return null!=r?r:void 0}function m(e){return new o.ArrayValue(e.keys.map((e=>new c.StringValue(e))))}function b(e,t){if(!e.value.hasOwnProperty(t))return e;const r={...e.value};return delete r[t],new u.ObjectValue(r)}function f(e,t){const r={};for(const n in e.value)0!==e.value[n].compareTo(t)&&(r[n]=e.value[n]);return new u.ObjectValue(r)}function S(e){return new o.ArrayValue(Object.values(e.value))}function d(e){return e.keys.length}e.exports.objectScope=l(),e.exports.createObjectScope=l,e.exports.join=p,e.exports.set=h,e.exports.get=g,e.exports.keys=m,e.exports.removeKey=b,e.exports.removeValues=f,e.exports.values=S,e.exports.length=d})),n.register("f6Hda",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.createMiscScope=e.exports.miscScope=void 0;var r=n("6PleH");function o(){const e=new r.Scope;return e.tryDefineFunc("toString",((e,t)=>{e.pushStackString(t.getIndex(0).toString())})),e.tryDefineFunc("typeof",((e,t)=>{e.pushStackString(t.getIndex(0).typename())})),e.tryDefineFunc("compareTo",((e,t)=>{e.pushStackNumber(t.getIndex(0).compareTo(t.getIndex(1)))})),e.tryDefineFunc("print",((e,t)=>{console.log(t.value.map((e=>e.toString())).join(""))})),e}e.exports.miscScope=o(),e.exports.createMiscScope=o})),n.register("8xi8G",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.Lexer=void 0;var r=n("bLFXl"),o=n("hxs7z"),s=n("g0lkP"),i=n("bDrYL"),a=n("4dh1X"),u=n("k9sml"),c=n("2mTEf"),l=n("jyc5U"),p=n("aYL6x");class h{static readFromLines(e){const t=new p.Tokeniser(e),r=[];for(;t.moveNext();)r.push(h.readFromTokeniser(t));return l.Token.list(c.EmptyCodeLocation,r)}static readFromTokeniser(e){const t=e.current;switch(t){case"(":return h.parseList(e,!0,")");case"[":return h.parseList(e,!1,"]");case"{":return h.parseMap(e);case")":case"]":case"}":throw new r.ParserError(e.currentLocation(),t,"Unexpected "+t);default:return l.Token.value(e.currentLocation(),h.parseConstant(t))}}static parseList(e,t,r){const n=e.lineNumber,o=e.columnNumber,s=[];for(;e.moveNext()&&e.current!==r;)s.push(h.readFromTokeniser(e));const i=e.createLocation(n,o),a=t?"expression":"list";return new l.Token(i,a,void 0,s)}static parseMap(e){const t=e.lineNumber,n=e.columnNumber,o={};for(;e.moveNext()&&"}"!==e.current;){const t=h.readFromTokeniser(e).toString();e.moveNext();const n=h.readFromTokeniser(e);if("expression"===n.type)throw new r.ParserError(n.location,"","Expression found in map literal");o[t]=n}return l.Token.map(e.createLocation(t,n),o)}static parseConstant(e){const t=parseFloat(e);if(!isNaN(t))return new i.NumberValue(t);if("true"===e)return o.BoolValue.True;if("false"===e)return o.BoolValue.False;if("null"===e)return s.NullValue.Value;const r=e[0],n=e[e.length-1];return'"'===r&&'"'===n||"'"===r&&"'"===n?new a.StringValue(e.substring(1,e.length-1)):new u.VariableValue(e)}}e.exports.Lexer=h})),n.register("jyc5U",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.Token=void 0;var r=n("iEt6a"),o=n("bLFXl");const s=[],i={};class a{constructor(e,t,n,o=s,a=i){this.location=e,this.value=n??r.NullValue.Value,this.type=t,this.tokenList=o,this.tokenMap=a}static empty(e){return new a(e,"empty")}static value(e,t){return new a(e,"value",t)}static expression(e,t){return new a(e,"expression",void 0,t)}static list(e,t){return new a(e,"list",void 0,t)}static map(e,t){return new a(e,"map",void 0,s,t)}getValue(){if("value"===this.type)return this.value;throw new o.AssemblerError(this,`Cannot get value of ${this.type} token`)}getValueCanBeEmpty(){return"empty"===this.type?void 0:this.getValue()}keepLocation(e){return"string"==typeof e?a.value(this.location,new r.StringValue(e)):a.value(this.location,e)}isNestedExpression(){return this.tokenList.length>0&&this.tokenList.every((e=>"expression"===e.type))}toEmpty(){return a.empty(this.location)}toString(){switch(this.type){default:case"empty":return"<empty>";case"expression":return"<TokenExpression>";case"value":return this.value.toString();case"list":return"<TokenList>";case"map":return"<TokenMap>"}}}e.exports.Token=a})),n.register("aYL6x",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.readFromTokens=e.exports.readAllTokens=e.exports.Tokeniser=void 0;var r=n("iIv5n"),o=n("hxs7z"),s=n("g0lkP"),i=n("bDrYL"),a=n("5dKj2"),u=n("4dh1X"),c=n("k9sml");function l(e){if(0===e.length)throw new Error("Unexpected end of tokens");const t=p(e);if("("===t){const t=[];for(;")"!==e[0];)t.push(l(e));return p(e),new r.ArrayValue(t)}if(")"===t)throw new Error("Unexpected )");if("{"===t){const t={};for(;"}"!==e[0];){const r=l(e).toString(),n=l(e);t[r]=n}return p(e),new a.ObjectValue(t)}if("}"===t)throw new Error("Unexpected }");return function(e){const t=parseFloat(e);if(!isNaN(t))return new i.NumberValue(t);if("true"===e)return o.BoolValue.True;if("false"===e)return o.BoolValue.False;if("null"===e)return s.NullValue.Value;const r=e[0],n=e[e.length-1];return'"'===r&&'"'===n||"'"===r&&"'"===n?new u.StringValue(e.substring(1,e.length-1)):new c.VariableValue(e)}(t)}function p(e){if(0===e.length)throw new Error("Unable to pop empty list");const t=e[0];return e.splice(0,1),t}e.exports.Tokeniser=class{constructor(e){this._returnSymbol="\0",this._inQuote="\0",this._escaped=!1,this._inComment=!1,this._accumulator="",this._lineNumber=0,this._columnNumber=0,this._startLineNumber=0,this._startColumnNumber=0,this._current="",this.input=e}get current(){return this._current}get lineNumber(){return this._lineNumber}get columnNumber(){return this._columnNumber}currentLocation(){return{startLineNumber:this._startLineNumber,startColumnNumber:this._startColumnNumber,endLineNumber:this._lineNumber,endColumnNumber:this._columnNumber}}createLocation(e,t){return{startLineNumber:e,startColumnNumber:t,endLineNumber:this._lineNumber,endColumnNumber:this._columnNumber}}moveNext(){if("\0"!==this._returnSymbol)return this._current=this._returnSymbol,this._returnSymbol="\0",!0;for(;this._lineNumber<this.input.length;){const e=this.input[this._lineNumber];if(0===e.length){this._lineNumber++;continue}const t=e[this._columnNumber++],r=this._columnNumber>=e.length;if(r&&(this._columnNumber=0,this._lineNumber++),this._inComment)r&&(this._inComment=!1);else if("\0"!==this._inQuote){if(this._escaped){switch(t){case'"':case"'":case"\\":this.appendChar(t);break;case"t":this.appendChar("\t");break;case"r":this.appendChar("\r");break;case"n":this.appendChar("\n")}this._escaped=!1;continue}if("\\"===t){this._escaped=!0;continue}if(this.appendChar(t),r&&this.appendChar("\n"),t===this._inQuote)return this._current=this._accumulator,this._accumulator="",this._inQuote="\0",!0}else switch(t){case";":this._inComment=!0;break;case'"':case"'":this._inQuote=t,this.appendChar(t);break;case"(":case")":case"[":case"]":case"{":case"}":return this._accumulator.length>0?(this._returnSymbol=t,this._current=this._accumulator,this._accumulator=""):this._current=t,!0;case" ":case"\t":case"\n":case"\r":if(this._accumulator.length>0)return this._current=this._accumulator,this._accumulator="",!0;break;default:this.appendChar(t)}}return!1}appendChar(e){0===this._accumulator.length&&(this._startLineNumber=this._lineNumber,this._startColumnNumber=this._columnNumber-1),this._accumulator+=e}},e.exports.readAllTokens=function(e){const t=[];for(;e.length>0;)t.push(l(e));return new r.ArrayValue(t)},e.exports.readFromTokens=l}));var o=n("iEt6a");function s(e){const t=document.getElementById(e),r=document.getElementById(e+"_output");if(null==t||null==r)return alert("Broken code example, unable to find code id: "+e),!1;const n=t?.value;return n?(r.innerHTML="",{output:r,text:n}):(r.innerHTML="Needs text input to parse",!1)}function i(e,t,r){try{return e.parseFromText(t,r)}catch(e){return e instanceof o.ParserError?"Parser error: "+e.message+"\nat location: "+(0,o.toStringCodeLocation)(e.location)+"\nat token: "+e.token:e instanceof o.AssemblerError?"Assembling error: "+e.message+"\nat location: "+(0,o.toStringCodeLocation)(e.token.location)+"\nat token: "+JSON.stringify(e.token):"Unknown error: "+e}}function a(e,t){try{return t.execute(e),!0}catch(e){return e instanceof o.VirtualMachineError?"Runtime error: "+e.message+"\nStack Trace: "+e.stackTrace.join("\n"):"Unknown error: "+e}}o=n("iEt6a");globalThis.runStdLib=function(e){const t=s(e);if(!1===t)return;const r=new(0,o.Assembler);(0,o.addToScope)(r.builtinScope,o.LibraryType.all),r.builtinScope.tryDefineFunc("print",((e,r)=>{const n=r.value.map((e=>e.toString())).join("");console.log(n),t.output.innerHTML+=n+"<br/>"}));const n=i(r,e,t.text);if("string"==typeof n)return void(t.output.innerHTML=n);const u=a(n,new(0,o.VirtualMachine)(16));!0!==u&&(t.output.innerHTML=u)};o=n("iEt6a");const u=function(){const e=new(0,o.Scope),t={pick:new(0,o.BuiltinFunctionValue)(((e,t)=>{let r=t;if(1===t.value.length){const e=t.getIndexCast(0,o.isArrayValue);e&&(r=e)}const n=Math.floor(Math.random()*r.arrayValues().length);e.pushStack(r.arrayValues()[n])}),"random.pick")};return e.tryDefine("random",new(0,o.ObjectValue)(t)),e}();const c=new(0,(o=n("iEt6a")).Scope);c.trySetConstantFunc("setBackground",((e,t)=>{document.body.setAttribute("background",t.getString(0))})),c.trySetConstantFunc("setTheme",((e,t)=>{document.body.setAttribute("theme",t.getString(0))})),globalThis.runPageSetup=function(){const e=s("codePageSetup");if(!1===e)return;const t=new(0,o.Assembler);(0,o.addToScope)(t.builtinScope,o.LibraryType.all),t.builtinScope.combineScope(c),t.builtinScope.combineScope(u),t.builtinScope.tryDefineFunc("print",((t,r)=>{const n=r.value.map((e=>e.toString())).join("");console.log(n),e.output.innerHTML+=n+"<br/>"}));const r=new(0,o.VirtualMachine)(16),n=i(t,"codePageSetup",e.text);if("string"==typeof n)return void(e.output.innerHTML=n);const l=a(n,r);!0!==l&&(e.output.innerHTML=l)};const l=new(0,(o=n("iEt6a")).Scope);l.tryDefineFunc("rand",((e,t)=>{e.pushStackNumber(Math.random())})),globalThis.runPerfTest=function(){const e=s("codePerfTest");if(!1===e)return;const t=new(0,o.Assembler);t.builtinScope.combineScope(l),t.builtinScope.tryDefineFunc("print",((t,r)=>{const n=r.value.map((e=>e.toString())).join("");console.log(n),e.output.innerHTML+=n+"<br/>"}));const r=i(t,"codePerfTest",e.text);if("string"==typeof r)return void(e.output.innerHTML=r);const n=new(0,o.VirtualMachine)(16),u=Date.now(),c=a(r,n);!0!==c&&(e.output.innerHTML=c);const p=Date.now();e.output.innerHTML+=`Time taken: ${p-u}ms <br/>`};o=n("iEt6a");let p;globalThis.runPrompt=function(e){const t=s(e);if(!1===t)return;const r=new(0,o.Assembler);(0,o.addToScope)(r.builtinScope,o.LibraryType.all),r.builtinScope.tryDefineFunc("print",((e,r)=>{const n=r.value.map((e=>e.toString())).join("");console.log(n),t.output.innerHTML+=n+"<br/>"})),r.builtinScope.tryDefineFunc("rand",((e,t)=>{e.pushStackNumber(Math.random())})),r.builtinScope.tryDefineFunc("wait",((e,t)=>{if(null==p)throw alert("Error, no runner found"),new Error("No runner found");p.waitUntil=t.getNumber(0)})),r.builtinScope.tryDefineFunc("prompt",((e,t)=>{const r=t.getString(0);console.log(r);const n=prompt(r);null===n?e.pushStack(o.NullValue.Value):e.pushStackString(n)}));const n=i(r,e,t.text);if("string"==typeof n)return void(t.output.innerHTML=n);const a=new(0,o.VirtualMachine)(16);a.changeToScript(n),a.running=!0,null!=p&&(p.running=!1),p=new(0,o.VirtualMachineRunner)(a),p.start().then((()=>{console.log("Program done")})).catch((e=>{e instanceof o.VirtualMachineError&&(t.output.innerHTML+=e.message+"<br/>"+e.stackTrace.join("<br/>"))}))};
//# sourceMappingURL=index.40561fab.js.map
